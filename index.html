<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Epic Car Dodge – Animated Sprite</title>
<style>
  * { box-sizing:border-box; }
  html,body { margin:0;padding:0;font-family:Poppins,sans-serif;background:linear-gradient(to bottom,#0f2027,#203a43,#2c5364);color:#fff;height:100%;display:flex;flex-direction:column;}
  header,footer {text-align:center;padding:1rem;background:rgba(0,0,0,0.3);}
  main { flex:1; display:flex; justify-content:center; align-items:center; padding:1rem; }
  #game-container {position:relative;width:90vw;max-width:480px;height:75vh;max-height:800px;background:#2d2d2d;border-radius:12px;overflow:hidden;box-shadow:0 0 20px #00fff7;}
  canvas { display:none; width:100%; height:100%; background:#333;}
  #overlay { position:absolute; top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:2;}
  .btn {background:#00fff7;color:#111;border:none;padding:0.8rem 2rem;border-radius:50px;font-size:1.2rem; font-weight:bold;cursor:pointer;box-shadow:0 4px 15px rgba(0,255,247,0.7);transition:0.3s;} .btn:hover{background:#00d6cc;}
  #score {position:absolute;top:1rem;left:1rem;background:rgba(0,0,0,0.5);padding:0.5rem 1rem;border-radius:8px;font-size:1rem;z-index:2;}
  @media(max-width:400px){.btn{font-size:1rem;padding:0.6rem 1.2rem;}header{font-size:1.5rem;}}
</style>
</head>
<body>
<header>Epic Car Dodge – Animated Sprite</header>
<main>
  <div id="game-container">
    <canvas id="game-canvas"></canvas>
    <div id="score">Score: 0</div>
    <div id="overlay">
      <h2>Tap or Press to Start</h2>
      <button class="btn" id="start-btn">Start Game</button>
    </div>
  </div>
</main>
<footer>© 2025 Epic Game Hub</footer>

<!-- Assets -->
<img id="carSprite" src="car_sprites.png" hidden/>
<audio id="engineSound" src="engine-rev.mp3"></audio>
<audio id="collisionSound" src="collision.mp3"></audio>
<audio id="shieldSound" src="powerup-shield.mp3"></audio>
<audio id="boostSound" src="powerup-speed.mp3"></audio>

<script>
const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');
const container = document.getElementById('game-container');
const overlay = document.getElementById('overlay');
const startBtn = document.getElementById('start-btn');
const scoreEl = document.getElementById('score');

const carImg = document.getElementById('carSprite');
const engineSound = document.getElementById('engineSound');
const collisionSound = document.getElementById('collisionSound');
const shieldSound = document.getElementById('shieldSound');
const boostSound = document.getElementById('boostSound');

let car, obstacles=[], powerUps=[], keys={}, score=0, speed=3, gameOver=false;
let frame=0, currentFrame=1, shield=false, boost=false, boostTimer=0;

function resizeCanvas(){ canvas.width=container.clientWidth; canvas.height=container.clientHeight; }
window.addEventListener('resize', resizeCanvas);

function reset(){
  score=0; speed=3; gameOver=false; frame=0;currentFrame=1;
  shield=false; boost=false; boostTimer=0;
  car = {
    w:canvas.width*0.2, h:canvas.height*0.1,
    x:canvas.width/2-canvas.width*0.1, y:canvas.height*0.8,
    speed:canvas.width/80
  };
  obstacles=[]; powerUps=[];
  scoreEl.textContent="Score:0";
}

function spawnObstacle(){
  const w=canvas.width*0.2;
  obstacles.push({x:Math.random()*(canvas.width-w),y:-w,w:h=w, h:w*1.2, speed:speed+Math.random()});
}

function spawnPowerUp(){
  const size=30, type=(Math.random()<0.5?'shield':'boost');
  powerUps.push({x:Math.random()*(canvas.width-size),y:-size,size,type});
}

function drawBackground(){
  ctx.fillStyle='#2d2d2d';ctx.fillRect(0,0,canvas.width,canvas.height);
}

function drawCar(){
  const sx = currentFrame*128, sy=0; // sprite frame width assumed 128px
  ctx.drawImage(carImg, sx, sy,128,128,car.x,car.y,car.w,car.h);
}

function drawObstacles(){
  obstacles.forEach(o=>ctx.fillStyle='#ff5555',ctx.fillRect(o.x,o.y+=o.speed,o.w,o.h));
  obstacles=obstacles.filter(o=>o.y<canvas.height);
}

function drawPowerUps(){
  powerUps.forEach(p=>{
    ctx.fillStyle = p.type==='shield'?'#00f':'#ff0';
    ctx.beginPath();
    ctx.arc(p.x+p.size/2,p.y+=2,p.size/2,0,2*Math.PI);
    ctx.fill();
  });
  powerUps=powerUps.filter(p=>p.y<canvas.height);
}

function collision(o){
  return car.x<o.x+o.w && car.x+car.w>o.x && car.y<o.y+o.h && car.y+car.h>o.y;
}

function update(){
  if(gameOver)return;
  frame++;
  if(frame%5===0){
    currentFrame = keys['ArrowLeft']||keys['a']?0: keys['ArrowRight']||keys['d']?2:1;
  }
  if(keys['ArrowLeft']||keys['a'])car.x-=car.speed;
  if(keys['ArrowRight']||keys['d'])car.x+=car.speed;
  car.x=Math.max(0,Math.min(canvas.width-car.w,car.x));
  obstacles.forEach(o=>o.y+=o.speed);
  powerUps.forEach(p=>p.y+=2);
  drawBackground(); drawCar(); drawObstacles(); drawPowerUps();

  obstacles.forEach(o=>{ if(collision(o)&&!shield){ collisionSound.play(); endGame();}})
  powerUps.forEach((p,i)=>{
    if(collision(p)){
      if(p.type==='shield'){ shield=true; shieldSound.play();}
      else { boost=true; boostTimer=300; boostSound.play();}
      powerUps.splice(i,1);
    }
  });

  if(boost){ car.speed = canvas.width/40; boostTimer--; if(boostTimer<=0){ boost=false; car.speed=canvas.width/80;} }

  score++; speed+=0.0005;
  scoreEl.textContent = `Score:${score}`;

  if(Math.random()<0.01)spawnObstacle();
  if(Math.random()<0.005)spawnPowerUp();

  requestAnimationFrame(update);
}

function endGame(){
  gameOver=true;
  overlay.innerHTML=`<h2>Game Over</h2><p>Score:${score}</p><button class="btn" id="restart">Restart</button>`;
  overlay.style.display='flex';
  collisionSound.play();
  document.getElementById('restart').onclick=()=>{overlay.style.display='none'; start();};
}

function start(){
  resizeCanvas(); reset();
  overlay.style.display='none';
  canvas.style.display='block';
  engineSound.currentTime=0; engineSound.play();
  update();
}

startBtn.onclick=start;
window.addEventListener('keydown',e=>keys[e.key]=true);
window.addEventListener('keyup',e=>keys[e.key]=false);
container.addEventListener('touchstart',e=>{
  const x=e.touches[0].clientX-canvas.getBoundingClientRect().left;
  keys[x<canvas.width/2?'ArrowLeft':'ArrowRight']=true;
});
container.addEventListener('touchend',()=>{keys['ArrowLeft']=keys['ArrowRight']=false;});
</script>
</body>
</html>
